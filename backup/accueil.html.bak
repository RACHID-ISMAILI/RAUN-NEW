<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>RAUN • Accueil</title>
  <meta name="theme-color" content="#031020">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&family=Orbitron:wght@500;700;800&family=Exo+2:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">

<!-- RAUN-ACTIONS-STYLES v2 -->
<style>
.raun-actions{ display:flex; gap:12px; align-items:center; margin:12px 0; flex-wrap:wrap; }
.raun-btn{ appearance:none; border:0; cursor:pointer; user-select:none;
  padding:10px 18px; border-radius:9999px; font-weight:700; font-family:inherit;
  transition:transform .06s ease, background .2s ease, color .2s ease; outline: none; }
.raun-btn:active{ transform:translateY(1px); }
.raun-join{ background:#f3f4f6; color:#111; border:1px solid #e5e7eb; }
.raun-join:hover{ background:#e9eaee; }
.raun-subscribe{ background:#111; color:#fff; }
.raun-subscribe:hover{ background:#000; }
.raun-modal{ position:fixed; inset:0; display:none; z-index:9999; }
.raun-modal.raun-open{ display:block; }
.raun-modal .raun-backdrop{ position:absolute; inset:0; background:rgba(0,0,0,.55); }
.raun-modal .raun-sheet{ position:absolute; right:0; top:0; bottom:0; width:min(420px,92vw);
  background:#0b1220; color:#eaf2ff; padding:22px; overflow:auto; box-shadow:-12px 0 40px rgba(0,0,0,.35); }
.raun-plan{ display:flex; justify-content:space-between; align-items:center; padding:12px 14px; border-radius:14px; background:#0e172a; margin:10px 0; border:1px solid #19233b; }
.raun-plan .raun-price{ opacity:.9; font-weight:700; }
.raun-plan button{ padding:8px 14px; border-radius:9999px; border:1px solid #2a3552; background:#0c60ff; color:#fff; font-weight:700; }
.raun-close{ background:transparent; color:#9fb3ff; border:0; font-weight:700; cursor:pointer; }
</style>

<!-- RAUN-EXPANDER-STYLES v1 -->
<style>:root{ --viewer-max-h: 72vh; } /* Ajustable */
.viewer{
  position: relative;
  display: flex;          /* colonne : titre/meta/btn visibles */
  flex-direction: column;
  max-height: var(--viewer-max-h);
  overflow: hidden;       /* le contenu scrolle DEDANS via .capsuleBody */
}

/* Scroll aligné à la fenêtre (dans le bloc bordé) */
.capsuleBody{
  flex: 1 1 auto;
  min-height: 0;                  /* autorise le shrink dans flex */
  overflow-y: auto;
  scrollbar-width: thin;          /* Firefox */
  scrollbar-gutter: stable;       /* pas de décalage moche */
}
.capsuleBody::-webkit-scrollbar{ width: 10px; }
.capsuleBody::-webkit-scrollbar-track{ background: rgba(255,255,255,.04); border-radius: 10px; }
.capsuleBody::-webkit-scrollbar-thumb{
  background: linear-gradient(180deg, rgba(0,198,255,.35), rgba(0,255,204,.35));
  border-radius: 10px;
  border: 2px solid rgba(3,13,26,.85);
}
.capsuleBody::-webkit-scrollbar-thumb:hover{
  background: linear-gradient(180deg, rgba(0,198,255,.50), rgba(0,255,204,.50));
}


/* Hauteur max par défaut en état initial + scroll interne */
:root{ --viewer-max-h: 72vh; } /* ajustable facilement */



/* Petit carreau en haut à droite pour agrandir/reduire la fenêtre capsule */
 /* discret : permet le positionnement absolu du bouton */
.raun-expander-btn{
  position:absolute; top:10px; right:10px; z-index:10;
  width:28px; height:28px; border-radius:6px;
  border:1px solid rgba(160,190,255,.35);
  background:rgba(15,25,45,.55); backdrop-filter: blur(6px);
  display:flex; align-items:center; justify-content:center;
  cursor:pointer; transition: transform .08s ease, filter .2s ease, border-color .2s ease;
}
.raun-expander-btn:hover{ filter:brightness(1.08); }
.raun-expander-btn:active{ transform: translateY(1px); }
.raun-expander-icon{
  width:16px; height:16px; position:relative; display:block;
}
/* icône: petit carré */
.raun-expander-icon::before{
  content:""; position:absolute; inset:2px;
  border:2px solid #9fb3ff; border-radius:3px;
  box-shadow:0 0 0 1px rgba(0,0,0,.2) inset;
}

/* Mode agrandi */
.raun-expanded{
  position: fixed !important;
  top: 10vh !important; left: 10vw !important;
  width: 80vw !important; height: 80vh !important;
  max-width: 80vw !important; max-height: 80vh !important;
  z-index: 9998 !important; background: rgba(3,13,26,.96) !important;
  border-radius: 16px; box-shadow: 0 30px 80px rgba(0,0,0,.45);
  overflow: hidden !important;      /* le scroll est géré par .capsuleBody */
  padding: 18px !important; box-sizing: border-box !important;
}
/* Empêcher le scroll de la page derrière */
.raun-no-scroll{ overflow: hidden !important; }

</style>
  <link rel="stylesheet" href="css/subscribe-toggle.css">
  <link rel="stylesheet" href="css/capsule-expand.css">

<style>
.capsuleBody img{
  max-width:100%; height:auto; display:block;
  border-radius:10px; margin:10px 0;
  box-shadow:0 6px 24px rgba(0,0,0,.25);
}
.capsuleBody .gallery{ display:grid; gap:10px; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); }
.capsuleBody .gallery img{ width:100%; height:auto; border-radius:12px; }
</style>


<!-- RAUN_CAPSULE_EXPAND_90_STYLE_START -->
<style>
.capsule.expanded-90 {
  position: fixed !important;
  top: 50% !important;
  left: 50% !important;
  transform: translate(-50%, -50%) !important;
  width: 90vw !important;
  height: 90vh !important;
  max-width: 90vw !important;
  max-height: 90vh !important;
  z-index: 9999 !important;
  margin: 0 !important;
  border-radius: 16px !important;
  overflow: auto !important;
  box-shadow: 0 20px 60px rgba(0,0,0,.50), 0 0 0 1px rgba(255,255,255,.08) inset;
  backdrop-filter: saturate(1.05);
}
.capsule-expanded-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, .65);
  backdrop-filter: blur(2px);
  z-index: 9998;
}
body.capsule-expanded-lock {
  overflow: hidden !important;
}
.capsule .capsule__enlarge {
  position: absolute;
  top: 10px; right: 10px;
  width: 28px; height: 28px;
  display: grid; place-items: center;
  border-radius: 6px;
  background: rgba(255,255,255,.08);
  border: 1px solid rgba(255,255,255,.24);
  cursor: pointer;
  font-size: 14px; line-height: 1;
  color: #e9eef9;
  user-select: none;
}
.capsule .capsule__enlarge:hover { background: rgba(255,255,255,.14); }
.capsule .capsule__enlarge:active { transform: translateY(1px); }
.capsule.expanded-90 .capsule__enlarge::after {
  content: "▣";
}
.capsule .capsule__enlarge::after {
  content: "▢";
}
</style>
<!-- RAUN_CAPSULE_EXPAND_90_STYLE_END -->


<!-- RAUN_CAPSULE_EXPAND_98_STYLE_START -->
<style>
/* Capsule expand to 98% viewport (almost fullscreen) */
.capsule.expanded-98 {
  position: fixed !important;
  top: 50% !important;
  left: 50% !important;
  transform: translate(-50%, -50%) !important;
  width: 98vw !important;
  height: 98vh !important;
  max-width: 98vw !important;
  max-height: 98vh !important;
  z-index: 9999 !important;
  margin: 0 !important;
  padding: 0 !important;
  border-radius: 12px !important;
  overflow: hidden !important;   /* scroll handled by inner areas */
  display: flex !important;
  flex-direction: column !important;
  box-shadow: 0 20px 70px rgba(0,0,0,.55), 0 0 0 1px rgba(255,255,255,.08) inset;
  background-clip: padding-box;
}
/* Make typical inner containers occupy available height and scroll if needed */
.capsule.expanded-98 .capsule-body,
.capsule.expanded-98 .capsule-content,
.capsule.expanded-98 .content,
.capsule.expanded-98 .inner,
.capsule.expanded-98 .scroll,
.capsule.expanded-98 .scrollable,
.capsule.expanded-98 main,
.capsule.expanded-98 section {
  flex: 1 1 auto;
  min-height: 0;
  overflow: auto;
}
/* Optional header/footer inside the capsule stay fixed height */
.capsule.expanded-98 header,
.capsule.expanded-98 .capsule-header,
.capsule.expanded-98 footer,
.capsule.expanded-98 .capsule-footer {
  flex: 0 0 auto;
}

/* Backdrop + body lock */
.capsule-expanded-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, .65);
  backdrop-filter: blur(2px);
  z-index: 9998;
}
body.capsule-expanded-lock {
  overflow: hidden !important;
}

/* Small square enlarge button (top-right) */
.capsule .capsule__enlarge {
  position: absolute;
  top: 10px; right: 10px;
  width: 28px; height: 28px;
  display: grid; place-items: center;
  border-radius: 6px;
  background: rgba(255,255,255,.08);
  border: 1px solid rgba(255,255,255,.24);
  cursor: pointer;
  font-size: 14px; line-height: 1;
  color: #e9eef9;
  user-select: none;
  z-index: 2;
}
.capsule .capsule__enlarge:hover { background: rgba(255,255,255,.14); }
.capsule .capsule__enlarge:active { transform: translateY(1px); }

.capsule.expanded-98 .capsule__enlarge::after { content: "▣"; }
.capsule .capsule__enlarge::after { content: "▢"; }
</style>
<!-- RAUN_CAPSULE_EXPAND_98_STYLE_END -->


<!-- RAUN_CAPSULE_EXPAND_98_V2_STYLE_START -->
<style>
/* ===== RAUN Capsule Expand 98% (V2) ===== */
.raun-capsule.expanded-98,
.capsule.expanded-98,
.capsule-window.expanded-98,
.capsule-card.expanded-98,
[data-capsule].expanded-98 {
  position: fixed !important;
  top: 50% !important;
  left: 50% !important;
  transform: translate(-50%, -50%) !important;
  width: 98vw !important;
  height: 98vh !important;
  max-width: 98vw !important;
  max-height: 98vh !important;
  z-index: 2147483000 !important; /* super high */
  margin: 0 !important;
  padding: 0 !important;
  border-radius: 12px !important;
  overflow: hidden !important;
  display: flex !important;
  flex-direction: column !important;
  box-shadow: 0 20px 70px rgba(0,0,0,.65), 0 0 0 1px rgba(255,255,255,.10) inset !important;
  background-clip: padding-box !important;
}
/* Fill inner content area to the available height */
.expanded-98 .capsule-body,
.expanded-98 .capsule-content,
.expanded-98 .content,
.expanded-98 .inner,
.expanded-98 .scroll,
.expanded-98 .scrollable,
.expanded-98 main,
.expanded-98 section,
.expanded-98 .pane,
.expanded-98 .panel {
  flex: 1 1 auto !important;
  min-height: 0 !important;
  overflow: auto !important;
}
/* Optional fixed header/footer (kept at natural height) */
.expanded-98 header,
.expanded-98 .capsule-header,
.expanded-98 footer,
.expanded-98 .capsule-footer {
  flex: 0 0 auto !important;
}
/* Backdrop + body lock */
.capsule-expanded-backdrop {
  position: fixed !important;
  inset: 0 !important;
  background: rgba(0, 0, 0, .70) !important;
  backdrop-filter: blur(2px) !important;
  z-index: 2147482990 !important;
}
body.capsule-expanded-lock { overflow: hidden !important; }

/* Small square enlarge button */
.raun-enlarge,
.capsule .capsule__enlarge {
  position: absolute; top: 10px; right: 10px;
  width: 28px; height: 28px; display: grid; place-items: center;
  border-radius: 6px; background: rgba(255,255,255,.10);
  border: 1px solid rgba(255,255,255,.28);
  cursor: pointer; font-size: 14px; line-height: 1; color: #e9eef9; user-select: none;
  z-index: 2;
}
.capsule .capsule__enlarge:hover, .raun-enlarge:hover { background: rgba(255,255,255,.18); }
.capsule .capsule__enlarge:active, .raun-enlarge:active { transform: translateY(1px); }
.expanded-98 .capsule__enlarge::after, .expanded-98 .raun-enlarge::after { content: "▣"; }
.capsule .capsule__enlarge::after, .raun-enlarge::after { content: "▢"; }
</style>
<!-- RAUN_CAPSULE_EXPAND_98_V2_STYLE_END -->

</head>
<body>
  <canvas id="matrix-bg"></canvas>
  <div id="particles"></div>

  <div id="notification" class="notification">
    <i class="fas fa-info-circle"></i><span id="notification-text">Bienvenue dans RAUN.</span>
  </div>

  <header>
    <div class="brand">
      <i class="fas fa-infinity"></i><span>RAUN</span>
    </div>
    <div class="navbtns">
      <button class="btn btn-purple" onclick="location.href='index.html'">
        <i class="fa fa-star"></i> Accueil
      </button>
      <button class="btn" onclick="location.href='public.html'">
        <i class="fa fa-home"></i> Public
      </button>
      <button class="btn" onclick="location.href='intentions.html'">
        <i class="fa fa-sparkles"></i> Intentions
      </button>
      <button class="btn" onclick="location.href='about.html'">
        <i class="fa fa-user-astronaut"></i> À propos
      </button>
      <button class="btn btn-amber" onclick="location.href='auth.html'">
        <i class="fa fa-user-shield"></i> Administration
      </button>
    </div>
  </header>

  <div class="wrap">
    <div class="home">
      <div class="home-hero">
        <div class="home-logo">RAUN</div>
        <div class="home-sub">« Réseau d'Âmes Unifiées Numériquement »</div>
        <div class="home-sign">Architecte de l'ombre</div>
        <button class="btn btn-cyan home-enter" onclick="location.href='public.html'">
          <i class="fa fa-door-open"></i> Entrer dans RAUN
        </button>
      </div>
    </div>

    <div class="footer">
      RAUN — « Réseau d'Âmes Unifiées Numériquement » — Architecte de l'ombre —
    </div>
  </div>

  <script>
// Choix auto du mode par page + baisse auto après 6s / 1er scroll
(function () {
  const page = (location.pathname.split('/').pop() || 'index.html').toLowerCase();
  let mode =
    page === 'index.html'         ? 'showcase' :
    page === 'public.html'        ? 'normal'   :
    page === 'intentions.html'    ? 'normal'   :
    /* about/auth/admin/autres */   'chill';

  // Mobile → chill quoi qu'il arrive
  if (matchMedia('(max-width: 600px)').matches) mode = 'chill';

  window.__raunMatrixConfig = Object.assign(window.__raunMatrixConfig || {}, { mode });

  // Si on démarre en showcase, on “redescend” automatiquement au premier scroll ou après 6s
  if (mode === 'showcase') {
    const downshift = () => window.__raunMatrixSetMode && window.__raunMatrixSetMode('normal');
    setTimeout(downshift, 6000);
    window.addEventListener('scroll', downshift, { once: true, passive: true });
  }
})();
</script>

<script>
// Boost vitrine pour index.html (uniquement)
(function () {
  const page = (location.pathname.split('/').pop() || 'index.html').toLowerCase();
  if (page !== 'index.html') return;
  window.__raunMatrixConfig = Object.assign(window.__raunMatrixConfig || {}, {
    hue: 170,         // cyan-teal
    segments: 24,     // traînée plus longue
    alpha: 0.18,      // glow un peu plus présent
    speedMin: 0.75,
    speedMax: 1.35
  });
})();
</script>

<script src="main.js"></script>
  <script src="index.js"></script>

<!-- RAUN-ACTIONS-SCRIPT v2 -->
<script>
(function(){
  if (window.__raunActionsLoaded2) return; window.__raunActionsLoaded2 = true;

  function mountActions(){
    // cibler la page publique : après .capsuleMeta
    var meta = document.querySelector('.capsuleMeta');
    if(!meta) return;
    if(meta.nextElementSibling && meta.nextElementSibling.classList && meta.nextElementSibling.classList.contains('raun-actions')) return;

    var wrap = document.createElement('div');
    wrap.className = 'raun-actions';
    var join = document.createElement('button'); join.type='button'; join.className='raun-btn raun-join'; join.textContent='Rejoindre';
    var sub  = document.createElement('button'); sub.type='button';  sub.className='raun-btn raun-subscribe'; sub.textContent="S'abonner";
    join.addEventListener('click', function(){ 
      var p = document.getElementById('raun-membership'); 
      if(!p){ document.body.insertAdjacentHTML('beforeend', '\n<!-- RAUN-MEMBERSHIP-PANEL v2 -->\n<div id="raun-membership" class="raun-modal" aria-hidden="true">\n  <div class="raun-backdrop" onclick="document.getElementById(\'raun-membership\').classList.remove(\'raun-open\')"></div>\n  <aside class="raun-sheet" role="dialog" aria-label="Adhésion RAUN">\n    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">\n      <h3>Bénéficiez d’avantages réservés aux membres</h3>\n      <button class="raun-close" onclick="document.getElementById(\'raun-membership\').classList.remove(\'raun-open\')">Fermer</button>\n    </div>\n    <p style="opacity:.8;margin:0 0 16px;">Paiement récurrent. Annulation possible à tout moment.</p>\n    <div class="raun-plan"><div><div style="font-weight:800;">الاشتراك البرونزي</div><div class="raun-price">25,00 MAD / mois</div></div><button onclick="location.href=\'#bronze\'">Rejoindre</button></div>\n    <div class="raun-plan"><div><div style="font-weight:800;">الاشتراك الفضي</div><div class="raun-price">90,00 MAD / mois</div></div><button onclick="location.href=\'#silver\'">Rejoindre</button></div>\n    <div class="raun-plan"><div><div style="font-weight:800;">الاشتراك الذهبي</div><div class="raun-price">225,00 MAD / mois</div></div><button onclick="location.href=\'#gold\'">Rejoindre</button></div>\n    <p style="opacity:.8;margin-top:16px;">Exemples : badges, contenus exclusifs, live privé…</p>\n  </aside>\n</div>\n'); p = document.getElementById('raun-membership'); }
      p.classList.add('raun-open');
    });
    sub.addEventListener('click', function(){
      try{ localStorage.setItem('raun_subscribed_public','1'); alert('Merci ! Abonnement enregistré.'); }catch(e){ alert('Abonnement enregistré.'); }
    });
    wrap.appendChild(join); wrap.appendChild(sub);
    meta.insertAdjacentElement('afterend', wrap);
  }

  // 1) au chargement
  if(document.readyState==='loading'){ document.addEventListener('DOMContentLoaded', mountActions); } else { mountActions(); }
  // 2) si le contenu de la capsule est rechargé dynamiquement, observe
  var viewer = document.querySelector('.viewer');
  if(viewer && 'MutationObserver' in window){
    var mo = new MutationObserver(function(){ mountActions(); });
    mo.observe(viewer, {childList:true, subtree:true});
  }
})();
</script>

<!-- RAUN-EXPANDER-SCRIPT v1 -->
<script>
(function(){
  if (window.__raunExpanderLoaded) return; window.__raunExpanderLoaded = true;

  function mount(){
    var viewer = document.querySelector('.viewer');
    if(!viewer) return;
    if(viewer.querySelector('.raun-expander-btn')) return;

    // bouton
    var btn = document.createElement('button');
    btn.type = 'button';
    btn.className = 'raun-expander-btn';
    btn.setAttribute('aria-label', 'Agrandir / Réduire la capsule');
    btn.innerHTML = '<span class="raun-expander-icon" aria-hidden="true"></span>';
    btn.addEventListener('click', function(){
      var expanded = viewer.classList.toggle('raun-expanded');
      document.documentElement.classList.toggle('raun-no-scroll', expanded);
      document.body.classList.toggle('raun-no-scroll', expanded);
      btn.setAttribute('aria-pressed', expanded ? 'true' : 'false');
    });

    viewer.appendChild(btn);
  }

  if(document.readyState === 'loading'){ document.addEventListener('DOMContentLoaded', mount); } else { mount(); }

  // Si la capsule se recharge dynamiquement (comme sur ta page publique), assurer la présence du bouton
  var anchor = document.querySelector('.viewer') || document.body;
  if('MutationObserver' in window && anchor){
    var mo = new MutationObserver(function(){ mount(); });
    mo.observe(anchor, {childList:true, subtree:true});
  }
})();
</script>
  <script src="js/subscribe-toggle.js"></script>
  <script src="js/capsule-expand.js"></script>

<script>
function escapeHtml(s){
  return s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
}
function renderCapsuleBody(raw){
  const safe = escapeHtml(String(raw||''))
    .replace(/\r?\n/g, '<br>')
    .replace(/(https?:\/\/[^\s]+?\.(?:png|jpe?g|gif|webp))/gi, '<img src="$1" alt="" loading="lazy">')
    .replace(/(https?:\/\/[^\s]+)/gi, '<a href="$1" target="_blank" rel="noopener">$1</a>');
  var el = document.getElementById('capsuleBody');
  if(el) el.innerHTML = safe;
}
document.addEventListener('click', function(e){
  var img = e.target.closest('.capsuleBody img');
  if(!img) return;
  var wrap = document.createElement('div');
  wrap.style.cssText = 'position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,.75);display:flex;align-items:center;justify-content:center;cursor:zoom-out';
  var big = document.createElement('img');
  big.src = img.src;
  big.style.cssText = 'max-width:90vw;max-height:90vh;border-radius:12px;box-shadow:0 20px 60px rgba(0,0,0,.6)';
  wrap.appendChild(big);
  wrap.addEventListener('click', function(){ wrap.remove(); });
  document.body.appendChild(wrap);
});
</script>


<!-- RAUN_CAPSULE_EXPAND_90_SCRIPT_START -->
<script>
(function(){"use strict";
  const SELECTORS = [
    '[data-capsule-expand]',
    '.btn-expand','.btn-maximize','.toggle-expand','.expand',
    '[aria-label*="agrandir" i]','[title*="agrandir" i]'
  ];
  function ensureBackdrop() {
    let bd = document.querySelector('.capsule-expanded-backdrop');
    if(!bd) {
      bd = document.createElement('div');
      bd.className = 'capsule-expanded-backdrop';
      bd.addEventListener('click', () => collapseAll());
      document.body.appendChild(bd);
    }
    return bd;
  }
  function expandCapsule(capsule) {
    if(!capsule) return;
    ensureBackdrop().style.display = 'block';
    document.body.classList.add('capsule-expanded-lock');
    capsule.classList.add('expanded-90');
    capsule.setAttribute('data-expanded','true');
  }
  function collapseCapsule(capsule) {
    if(!capsule) return;
    capsule.classList.remove('expanded-90');
    capsule.removeAttribute('data-expanded');
    const any = document.querySelector('.capsule.expanded-90');
    if(!any) {
      const bd = document.querySelector('.capsule-expanded-backdrop');
      if(bd) bd.style.display = 'none';
      document.body.classList.remove('capsule-expanded-lock');
    }
  }
  function collapseAll(){
    document.querySelectorAll('.capsule.expanded-90').forEach(c => c.classList.remove('expanded-90'));
    const bd = document.querySelector('.capsule-expanded-backdrop');
    if(bd) bd.style.display = 'none';
    document.body.classList.remove('capsule-expanded-lock');
  }
  function toggleCapsule(capsule) {
    if(!capsule) return;
    if(capsule.classList.contains('expanded-90')) collapseCapsule(capsule);
    else expandCapsule(capsule);
  }
  window.RAUN_toggleCapsule90 = function(el){
    const cap = el && el.closest ? el.closest('.capsule') : null;
    toggleCapsule(cap || document.querySelector('.capsule'));
  };

  function attach() {
    const candidates = document.querySelectorAll('.capsule, .capsule-window, .capsule-card, [data-capsule]');
    candidates.forEach(cap => {
      const hasExisting = cap.querySelector(SELECTORS.join(','));
      if(!hasExisting && !cap.querySelector('.capsule__enlarge')) {
        const btn = document.createElement('button');
        btn.className = 'capsule__enlarge';
        btn.type = 'button';
        btn.setAttribute('aria-label','Agrandir / Réduire la capsule');
        btn.addEventListener('click', e => { e.stopPropagation(); toggleCapsule(cap); });
        if(getComputedStyle(cap).position === 'static') cap.style.position = 'relative';
        cap.appendChild(btn);
      }
    });
  }

  document.addEventListener('click', function(e){
    const t = e.target;
    if(!t) return;
    const c = t.closest('.capsule, .capsule-window, .capsule-card, [data-capsule]');
    if(!c) return;
    const isControl = SELECTORS.some(sel => t.matches(sel) || (t.closest && t.closest(sel)));
    if(isControl || t.classList.contains('capsule__enlarge')) {
      e.preventDefault();
      e.stopPropagation();
      toggleCapsule(c);
    }
  }, true);

  document.addEventListener('keydown', function(e){ if(e.key === 'Escape') collapseAll(); });

  if(document.readyState === 'loading') document.addEventListener('DOMContentLoaded', attach);
  else attach();
})();
</script>
<!-- RAUN_CAPSULE_EXPAND_90_SCRIPT_END -->


<!-- RAUN_CAPSULE_EXPAND_98_SCRIPT_START -->
<script>
(function(){"use strict";
  const SELECTORS = [
    '[data-capsule-expand]',
    '.btn-expand','.btn-maximize','.toggle-expand','.expand',
    '[aria-label*="agrandir" i]','[title*="agrandir" i]'
  ];
  function ensureBackdrop() {
    let bd = document.querySelector('.capsule-expanded-backdrop');
    if(!bd) {
      bd = document.createElement('div');
      bd.className = 'capsule-expanded-backdrop';
      bd.addEventListener('click', () => collapseAll());
      document.body.appendChild(bd);
    }
    return bd;
  }
  function expandCapsule(capsule) {
    if(!capsule) return;
    ensureBackdrop().style.display = 'block';
    document.body.classList.add('capsule-expanded-lock');
    capsule.classList.add('expanded-98');
    capsule.setAttribute('data-expanded','true');
  }
  function collapseCapsule(capsule) {
    if(!capsule) return;
    capsule.classList.remove('expanded-98');
    capsule.removeAttribute('data-expanded');
    const any = document.querySelector('.capsule.expanded-98');
    if(!any) {
      const bd = document.querySelector('.capsule-expanded-backdrop');
      if(bd) bd.style.display = 'none';
      document.body.classList.remove('capsule-expanded-lock');
    }
  }
  function collapseAll(){
    document.querySelectorAll('.capsule.expanded-98').forEach(c => c.classList.remove('expanded-98'));
    const bd = document.querySelector('.capsule-expanded-backdrop');
    if(bd) bd.style.display = 'none';
    document.body.classList.remove('capsule-expanded-lock');
  }
  function toggleCapsule(capsule) {
    if(!capsule) return;
    if(capsule.classList.contains('expanded-98')) collapseCapsule(capsule);
    else expandCapsule(capsule);
  }
  // Public helper (if your HTML calls it)
  window.RAUN_toggleCapsule98 = function(el){
    const cap = el && el.closest ? el.closest('.capsule') : null;
    toggleCapsule(cap || document.querySelector('.capsule'));
  };

  function attach() {
    const candidates = document.querySelectorAll('.capsule, .capsule-window, .capsule-card, [data-capsule]');
    candidates.forEach(cap => {
      const hasExisting = cap.querySelector(SELECTORS.join(','));
      if(!hasExisting && !cap.querySelector('.capsule__enlarge')) {
        const btn = document.createElement('button');
        btn.className = 'capsule__enlarge';
        btn.type = 'button';
        btn.setAttribute('aria-label','Agrandir / Réduire la capsule');
        btn.addEventListener('click', e => { e.stopPropagation(); toggleCapsule(cap); });
        if(getComputedStyle(cap).position === 'static') cap.style.position = 'relative';
        cap.appendChild(btn);
      }
    });
  }

  // Delegate clicks on known controls
  document.addEventListener('click', function(e){
    const t = e.target;
    if(!t) return;
    const c = t.closest('.capsule, .capsule-window, .capsule-card, [data-capsule]');
    if(!c) return;
    const isControl = SELECTORS.some(sel => t.matches(sel) || (t.closest && t.closest(sel)));
    if(isControl || t.classList.contains('capsule__enlarge')) {
      e.preventDefault();
      e.stopPropagation();
      toggleCapsule(c);
    }
  }, true);

  // ESC to close
  document.addEventListener('keydown', function(e){ if(e.key === 'Escape') collapseAll(); });

  if(document.readyState === 'loading') document.addEventListener('DOMContentLoaded', attach);
  else attach();
})();
</script>
<!-- RAUN_CAPSULE_EXPAND_98_SCRIPT_END -->


<!-- RAUN_CAPSULE_EXPAND_98_V2_SCRIPT_START -->
<script>
(function(){"use strict";
  const SEL_CAPSULE = '.raun-capsule, .capsule, .capsule-window, .capsule-card, [data-capsule]';
  const SEL_CONTROLS = [
    '[data-capsule-expand]','.btn-expand','.btn-maximize','.toggle-expand','.expand',
    '[aria-label*="agrandir" i]','[title*="agrandir" i]','.capsule__enlarge','.raun-enlarge',
    '.fa-expand','.icon-expand','[data-action="expand"]'
  ];

  function qAll(sel, root=document){ try{ return Array.from(root.querySelectorAll(sel)); }catch(e){ return []; } }
  function isEl(x){ return x && x.nodeType===1; }

  function ensureBackdrop(){ 
    let bd = document.querySelector('.capsule-expanded-backdrop');
    if(!bd){ bd = document.createElement('div'); bd.className = 'capsule-expanded-backdrop'; document.body.appendChild(bd); }
    return bd;
  }

  function closestCapsule(el){
    if(!isEl(el)) return null;
    return el.closest(SEL_CAPSULE);
  }

  function expandCapsule(cap){
    if(!cap) return;
    ensureBackdrop().style.display = 'block';
    document.body.classList.add('capsule-expanded-lock');
    cap.classList.add('expanded-98');
    cap.setAttribute('data-expanded','true');
  }

  function collapseCapsule(cap){
    if(!cap) return;
    cap.classList.remove('expanded-98');
    cap.removeAttribute('data-expanded');
    if(!document.querySelector(SEL_CAPSULE+'.expanded-98')){
      const bd = document.querySelector('.capsule-expanded-backdrop');
      if(bd) bd.style.display='none';
      document.body.classList.remove('capsule-expanded-lock');
    }
  }

  function collapseAll(){
    qAll(SEL_CAPSULE+'.expanded-98').forEach(c=>c.classList.remove('expanded-98'));
    const bd = document.querySelector('.capsule-expanded-backdrop');
    if(bd) bd.style.display='none';
    document.body.classList.remove('capsule-expanded-lock');
  }

  function toggleCapsule(cap){
    if(!cap) return;
    if(cap.classList.contains('expanded-98')) collapseCapsule(cap);
    else expandCapsule(cap);
  }

  // Public helpers
  window.RAUN_toggleCapsule98 = function(el){ toggleCapsule(closestCapsule(el) || qAll(SEL_CAPSULE)[0]); };
  window.RAUN_expandCapsule98 = function(sel){ const cap = typeof sel==='string' ? document.querySelector(sel) : closestCapsule(sel); if(cap) expandCapsule(cap); };
  window.RAUN_collapseCapsule98 = collapseAll;

  // Inject small square if none exists
  function injectButtonInto(cap){
    if(!isEl(cap)) return;
    const already = cap.querySelector('.capsule__enlarge, .raun-enlarge');
    if(already) return;
    const btn = document.createElement('button');
    btn.type='button'; btn.className='raun-enlarge'; btn.setAttribute('aria-label','Agrandir / Réduire la capsule');
    btn.addEventListener('click', e=>{ e.stopPropagation(); toggleCapsule(cap); });
    if(getComputedStyle(cap).position === 'static') cap.style.position = 'relative';
    cap.appendChild(btn);
  }

  function attachAll(){
    qAll(SEL_CAPSULE).forEach(injectButtonInto);
  }

  // Click delegation for any control inside a capsule
  document.addEventListener('click', function(e){
    const t = e.target;
    const cap = closestCapsule(t);
    if(!cap) return;
    const isControl = SEL_CONTROLS.some(sel => t.matches(sel) || (t.closest && t.closest(sel)));
    if(isControl){ e.preventDefault(); e.stopPropagation(); toggleCapsule(cap); }
  }, true);

  // ESC closes
  document.addEventListener('keydown', function(e){ if(e.key === 'Escape') collapseAll(); });

  // Hotkey: Shift+E toggles the first visible capsule
  document.addEventListener('keydown', function(e){
    if(e.shiftKey && (e.key==='E' || e.key==='e')){ const cap = qAll(SEL_CAPSULE).find(el => el.offsetParent !== null); if(cap) toggleCapsule(cap); }
  });

  // Observe DOM mutations to handle dynamically injected capsules
  const mo = new MutationObserver(muts=>{
    muts.forEach(m=>{
      m.addedNodes && m.addedNodes.forEach(n=>{
        if(!isEl(n)) return;
        if(n.matches && n.matches(SEL_CAPSULE)) injectButtonInto(n);
        qAll(SEL_CAPSULE, n).forEach(injectButtonInto);
      })
    });
  });
  mo.observe(document.documentElement, { childList:true, subtree:true });

  // Ensure backdrop exists once
  ensureBackdrop().style.display = 'none';

  // Initial attach
  if(document.readyState==='loading') document.addEventListener('DOMContentLoaded', attachAll);
  else attachAll();

  // Debug: expose a quick check
  console.debug('RAUN Capsule Expand 98 V2 loaded');
})();
</script>
<!-- RAUN_CAPSULE_EXPAND_98_V2_SCRIPT_END -->

</body>
</html>
